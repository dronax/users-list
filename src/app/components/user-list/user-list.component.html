<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 mb-0 text-black fw-bold">Users Lists</h1>
        <div class="d-flex gap-3 align-items-center">
          <div class="btn-group" role="group" aria-label="Layout toggle">
            <button
              type="button"
              class="btn btn-outline-secondary"
              [class.active]="layoutMode === 'table'"
              (click)="toggleLayoutMode()"
              [disabled]="isLoading"
              title="Table View"
            >
              <i class="bi bi-table"></i>
            </button>
            <button
              type="button"
              class="btn btn-outline-secondary"
              [class.active]="layoutMode === 'card'"
              (click)="toggleLayoutMode()"
              [disabled]="isLoading"
              title="Card View"
            >
              <i class="bi bi-grid-3x3-gap"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="bg-light p-4 rounded mb-4">
        <div class="row g-3 align-items-center">
          <div class="col-md-6 col-lg-5">
            <div class="position-relative">
              <div class="input-group">
                <span class="input-group-text bg-white">
                  <i class="bi bi-search text-muted"></i>
                </span>
                <input
                  #searchInput
                  type="text"
                  class="form-control"
                  placeholder="Search by name or email..."
                  [value]="searchTerm"
                  (input)="onSearchChange($event)"
                  [disabled]="isLoading"
                />
                <button
                  *ngIf="searchTerm && searchTerm.length > 0"
                  type="button"
                  class="btn btn-outline-secondary"
                  (click)="clearSearch(searchInput)"
                  [disabled]="isLoading"
                  title="Clear search"
                >
                  <i class="bi bi-x-lg"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-lg-2">
            <select
              class="form-select"
              [value]="pageSize"
              (change)="onPageSizeChange(+$any($event.target).value)"
              [disabled]="isLoading"
            >
              <option *ngFor="let size of pageSizeOptions" [value]="size">
                {{ size }} per page
              </option>
            </select>
          </div>
        </div>
      </div>

      <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-muted">Loading users...</p>
      </div>

      <div *ngIf="error && !isLoading" class="alert alert-danger" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        {{ error }}
        <button
          type="button"
          class="btn btn-dark btn-sm ms-3"
          (click)="loadUsers()"
        >
          Try Again
        </button>
      </div>

      <div
        *ngIf="
          !isLoading &&
          !error &&
          paginatedUsers.length === 0 &&
          totalUsers === 0
        "
        class="text-center py-5"
      >
        <i class="bi bi-search display-1 text-muted"></i>
        <h3 class="mt-3">No users found</h3>
        <p class="text-muted">Try adjusting your search criteria</p>
      </div>

      <div
        *ngIf="
          !isLoading &&
          !error &&
          paginatedUsers.length > 0 &&
          layoutMode === 'table'
        "
        class="table-responsive"
      >
        <table class="table table-hover table-striped">
          <thead class="table-dark">
            <tr>
              <th scope="col"><i class="bi bi-person-fill me-2"></i>Name</th>
              <th scope="col" class="d-none d-md-table-cell">
                <i class="bi bi-at me-2"></i>Username
              </th>
              <th scope="col"><i class="bi bi-envelope-fill me-2"></i>Email</th>
              <th scope="col" class="d-none d-lg-table-cell">
                <i class="bi bi-telephone-fill me-2"></i>Phone
              </th>
              <th scope="col" class="d-none d-lg-table-cell">
                <i class="bi bi-building-fill me-2"></i>Company
              </th>
              <th scope="col" class="text-center">
                <i class="bi bi-gear-fill me-2"></i>Actions
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of paginatedUsers">
              <td>
                <div class="fw-semibold">{{ user.name }}</div>
                <small class="text-muted d-md-none">{{
                  "@" + user.username
                }}</small>
              </td>
              <td class="d-none d-md-table-cell">{{ user.username }}</td>
              <td>
                <div>{{ user.email }}</div>
                <small class="text-muted d-lg-none">
                  <i class="bi bi-telephone me-1"></i>{{ user.phone }}<br />
                  <i class="bi bi-building me-1"></i>{{ user.company.name }}
                </small>
              </td>
              <td class="d-none d-lg-table-cell">{{ user.phone }}</td>
              <td class="d-none d-lg-table-cell">{{ user.company.name }}</td>
              <td class="text-center">
                <button
                  type="button"
                  class="btn btn-dark btn-sm"
                  (click)="viewUserDetail(user.id)"
                >
                  <span class="d-none d-sm-inline">View Details</span>
                  <span class="d-sm-none">View</span>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        *ngIf="
          !isLoading &&
          !error &&
          paginatedUsers.length > 0 &&
          layoutMode === 'card'
        "
        class="row"
      >
        <div *ngFor="let user of paginatedUsers" class="col-md-6 col-lg-4 mb-4">
          <div class="card h-100 shadow-sm hover-card">
            <div class="card-body">
              <h5 class="card-title text-primary">{{ user.name }}</h5>
              <h6 class="card-subtitle mb-2 text-muted">
                &#64;{{ user.username }}
              </h6>
              <p class="card-text">
                <small class="text-muted">
                  <i class="bi bi-envelope me-1"></i> {{ user.email }} </small
                ><br />
                <small class="text-muted">
                  <i class="bi bi-telephone me-1"></i> {{ user.phone }} </small
                ><br />
                <small class="text-muted">
                  <i class="bi bi-building me-1"></i> {{ user.company.name }}
                </small>
              </p>
            </div>
            <div class="card-footer bg-transparent">
              <button
                type="button"
                class="btn btn-dark btn-sm"
                (click)="viewUserDetail(user.id)"
              >
                View Details
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoading && !error && totalUsers > pageSize" class="mt-4">
        <div class="row align-items-center">
          <div class="col-12 col-md-auto mb-2 mb-md-0">
            <small class="text-muted">
              Page {{ currentPage }} of
              {{ Math.ceil(totalUsers / pageSize) }} ({{
                (currentPage - 1) * pageSize + 1
              }}-{{ Math.min(currentPage * pageSize, totalUsers) }} of
              {{ totalUsers }})
            </small>
          </div>
          <div
            class="col-12 col-md d-flex justify-content-center justify-content-md-end"
          >
            <ngb-pagination
              [(page)]="currentPage"
              [pageSize]="pageSize"
              [collectionSize]="totalUsers"
              [maxSize]="5"
              [rotate]="true"
              [boundaryLinks]="true"
              (pageChange)="onPageChange($event)"
            >
            </ngb-pagination>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
